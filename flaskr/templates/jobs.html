{% extends "Layout.html" %}

{% block title %} All Jobs {% endblock %}
{% block name %} Jobs {% endblock %}

{% block page_actions %}
  <div style="display:flex; gap:8px;">
    <a class="btn btn-sm btn-outline-light" href="/analyze"><i class="fas fa-upload"></i>&nbsp; Upload</a>
    <button class="btn btn-sm btn-outline-light" onclick="location.reload();"><i class="fas fa-sync"></i>&nbsp; Refresh</button>
  </div>
{% endblock %}

{% block content %}
  <div class="panel">
    <div class="panel-title"><i class="fas fa-file-alt"></i> Uploaded log files</div>
    <div class="panel-sub" style="margin-bottom:12px;">Select a file and click Analyze to replay logs into Grafana.</div>

    <div class="table-responsive">
        <table class="table table-dark table-hover table-sm align-middle mb-0" 
                style="background: transparent; border-collapse: separate; border-spacing: 0 6px;">
            <thead style="background: rgba(255,255,255,0.04);">
            <tr>
                <th scope="col" class="text-uppercase small fw-bold text-secondary">Username</th>
                <th scope="col" class="text-uppercase small fw-bold text-secondary">File Name</th>
                <th scope="col" class="text-uppercase small fw-bold text-secondary">Time</th>
                <th scope="col" class="text-uppercase small fw-bold text-secondary">Scenario</th>
                <th scope="col" class="text-uppercase small fw-bold text-secondary">Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for job in all_jobs %}
            <tr style="background: var(--panel-bg); border: 1px solid rgba(255,255,255,0.05); border-radius: 6px;">
                <td class="text-light">{{ job.username }}</td>
                <td class="text-light" style="word-break:break-word;">{{ job.filename }}</td>
                <td class="text-light">{{ job.time }}</td>
                <td class="text-light">
                  <select class="form-select form-select-sm bg-dark text-light border-secondary" name="scenario" form="analyze-form-{{ job.sno }}" style="width: 90px;">
                        <option value="4G_BASIC">4G_BASIC</option>
                        <option value="4G_STATE_CHANGE">4G_STATE_CHANGE</option>
                        <option value="5G" selected>5G</option>
                  </select>
                </td>
                <td>
                <div class="d-flex gap-2 align-items-center">
                    <form id="analyze-form-{{ job.sno }}" action='/jobs' method="POST" target="_blank">
                    <input type="hidden" name="username" value="{{ job.username }}">
                    <input type="hidden" name="SNo" value="{{ job.sno }}">
                    <button type="submit" class="btn btn-sm btn-success btn-compact" name="analyze">
                        <i class="fas fa-play"></i> Analyze
                    </button>
                    </form>
                    <form action='/jobs' method="POST">
                    <input type="hidden" name="username" value="{{ job.username }}">
                    <input type="hidden" name="SNo" value="{{ job.sno }}">
                    <button type="submit" class="btn btn-sm btn-outline-danger btn-compact" name="delete">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                    </form>
                </div>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
  </div>
{% endblock %}